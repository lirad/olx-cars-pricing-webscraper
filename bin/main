#!/usr/bin/env ruby

require "nokogiri"
require "open-uri"

def fetch_car_brands
  html_data = open("https://www.olx.com.br/autos-e-pecas/carros-vans-e-utilitarios").read
  nokogiri_object = Nokogiri::HTML(html_data)
  states = nokogiri_object.css(".sc-1a202fr-0")
  car_brands = nokogiri_object.css(".sc-125sd1n-5 .g98wuw-1 option")
  car_models_list = []
  car_brands.each do |brands|
    car_models_list << brands.content
  end
  return car_models_list
end

def fetch_car_models(car_brand)
  html_car_model = open("https://www.olx.com.br/autos-e-pecas/carros-vans-e-utilitarios/#{car_brand}").read
  car_brand = Nokogiri::HTML(html_car_model)
  car_models = car_brand.css("div.sc-19se6iy-1.dGiePB > form > div:nth-child(1) > div:nth-child(3) > div.sc-125sd1n-2.gcOAdt > div > div > select")
  return car_models
end

# List user car brands
puts "Please type a Car Brand or type 'List' to see all options"
selected_car_brand = gets.chomp.downcase
case selected_car_brand
when "list"
  fetch_car_brands.each_with_index do |value, index|
    puts "#{index}. #{value} "
  end
else
  fetch_car_brands.each do |n|
    unless n.match?(selected_car_brand.upcase)
      puts fetch_car_models(selected_car_brand)
      puts "Please select or type a model from the list"
      selected_car_type = gets.chomp.downcase
      break
    end
  end
end
# fetch_car_models(selected_car_brand)

# Get user car model
# Search trough every state
# Give pricing
